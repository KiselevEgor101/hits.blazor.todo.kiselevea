@page "/accounts/add"
@using TheFinalProject.Models
@using TheFinalProject.Data.Services
@inject AccountService AccountService
@inject DepartmentService DepartmentService
@inject NavigationManager NavManager

<h3>Добавить счет</h3>



@if (accountType == "regular")
{
    <EditForm Model="account" OnValidSubmit="HandleValidSubmit">
        <DataAnnotationsValidator />
        <ValidationSummary class="text-danger" />

        <div class="mb-3">
            <label class="form-label">Название счета</label>
            <InputText class="form-control" @bind-Value="account.DisplayName" />
            <ValidationMessage For="@(() => account.DisplayName)" />
        </div>

        <div class="mb-3">
            <label class="form-label">Тип счёта</label>

            <InputSelect class="form-control" @bind-Value="account.Role">
                <option value="">-- Выберите тип счёта --</option>
                <option value="Наличные">Дебетовый</option>
                <option value="Карта">Инвестиционный</option>
                <option value="Вклад">Вклад</option>
            </InputSelect>

            <ValidationMessage For="@(() => account.Role)" />
        </div>


        <div class="mb-3">
            <label class="form-label">Категория</label>
            <InputSelect class="form-control" @bind-Value="account.DepartmentId">
                <option value="0">-- Выберите категорию --</option>
                @foreach (var dept in departments)
                {
                    <option value="@dept.Id">@dept.Name</option>
                }
            </InputSelect>
            <ValidationMessage For="@(() => account.DepartmentId)" />
        </div>

        <button type="submit" class="btn btn-success">Сохранить</button>
        <a href="/accounts" class="btn btn-secondary">Отмена</a>
    </EditForm>
}
else
{
    <div class="alert alert-info">
        Для добавления стажера используйте <a href="/interns/add">страницу стажеров</a>
    </div>
    <a href="/interns/add" class="btn btn-primary">Перейти к добавлению стажера</a>
}

@code {
    private Account account = new();
    private List<Department> departments = new();
    private string accountType = "regular";

    protected override async Task OnInitializedAsync()
    {
        departments = await DepartmentService.GetDepartmentsAsync();
    }

    private async Task HandleValidSubmit()
    {
        await AccountService.CreateAccountAsync(account);
        NavManager.NavigateTo("/accounts");
    }
}
